<div class="text-light layout-root">

  <div class="container-xxl my-4 flex-grow-1">

    <!-- Hero -->
    <div class="card hero-card card-dark surface-gradient rounded-4 mb-4 border border-divider overflow-hidden">
      <div class="row g-0 g-sm-3 align-items-stretch">
        <div class="col-md-6">
          <div class="hero-media">
            <img alt="Hero" class="w-100 h-100 object-cover" *ngIf="topgame" [src]="getCardImage(topgame)" />
          </div>
        </div>
        <div class="col-md-6">
          <div class="hero-body p-3 p-sm-4 h-100 d-flex flex-column justify-content-center">
            <h2 class="h4 fw-bold mb-2 text-white">{{topgame?.name}}</h2>
            <p class="small mb-3 text-muted-70">
              {{topgame?.description}}
              developed by <a class="link-light text-decoration-none opacity-75" href="#">{{topgame?.developer}}</a>.
            </p>
            <div class="d-flex flex-wrap align-items-center gap-2 mb-3">
              <span *ngFor="let cat of topgame?.categories" class="badge rounded-pill px-3 py-2 chip border">
                {{ cat.category_name }}
              </span>
            </div>

            <div class="d-flex flex-wrap gap-2">
              <a class="btn btn-soft rounded-3 border border-divider" href="#">View Details</a>
              <a class="btn btn-soft-strong rounded-3 border border-divider" href="#">
                <i class="bi bi-cart-plus me-2"></i>Add to Cart — ฿{{topgame?.price}}
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Layout: ซ้ายเลื่อน / ขวา sticky -->
    <div class="row gx-4 gy-4 align-items-start">

      <!-- Left: SearchBar + Game grid (scrollable) -->
      <div class="col-lg-9 order-1 order-lg-0 game-left-pane">
        <div class="space-y-4 flex-shrink-0">
          <!-- SearchBar -->
          <div class="input-group input-group-lg">
            <span class="input-group-text bg-transparent text-secondary border border-divider">
              <i class="bi bi-search"></i>
            </span>
            <input type="search" class="form-control bg-glass border border-divider"
              placeholder="Search games, genres, tags...">
          </div>
        </div>

        <!-- GameCard Grid (เลื่อนเฉพาะส่วนนี้) -->
        <!-- GameCard Grid (เลื่อนเฉพาะส่วนนี้) -->
        <div class="game-grid-scroll mt-3">
          <div class="row row-cols-1 row-cols-sm-2 row-cols-lg-3 g-4">

            <ng-container *ngIf="gamesFilted?.length; else emptyGrid">
              <div class="col" *ngFor="let g of gamesFilted; trackBy: trackByGid">
                <div class="card card-game h-100 rounded-4 card-dark hover-outline overflow-hidden">

                  <div class="ratio ratio-16x9 bg-black bg-opacity-50">
                    <img class="w-100 h-100 object-fit-cover" [src]="getCardImage(g)" [alt]="g.name" />
                  </div>

                  <div class="card-body">
                    <h6 class="card-title mb-2 text-white text-truncate">{{ g.name }}</h6>

                    <div class="d-flex flex-wrap gap-2 mb-2">
                      <span *ngFor="let cat of g?.categories"
                        class="badge rounded-pill px-3 chip border border-white-10">{{ cat.category_name }}</span>
                    </div>

                    <div class="d-flex align-items-center justify-content-between">
                      <span class="text-white-80 fw-semibold">
                        ฿{{ toPrice(g) }}
                      </span>

                      <div class="d-flex gap-2">
                        <a class="btn btn-soft rounded-3 border border-divider">Details</a>

                        <button type="button" class="btn btn-soft-strong rounded-3 border border-divider"
                          (click)="addToCart(g)">
                          Add
                        </button>
                      </div>
                    </div>
                  </div>

                </div>
              </div>
            </ng-container>

            <!-- ว่าง/กำลังโหลด -->
            <ng-template #emptyGrid>
              <div class="col-12 col-md-8 col-lg-6 mx-auto">
                <div class="card card-dark rounded-4 border border-divider">
                  <div class="card-body text-secondary empty-center text-center">
                    No games to display.
                  </div>
                </div>
              </div>
            </ng-template>

          </div>
        </div>

      </div>

      <!-- Right: Filters (sticky) -->
      <div class="col-lg-3 order-0 order-lg-1">
        <div class="card rounded-4 card-dark border border-divider h-fit position-sticky" style="top:88px">
          <div class="card-body">
            <div class="h6 fw-semibold mb-3 text-white">Filters</div>

            <!-- Category -->
            <div class="mb-3">
              <div class="small mb-2" style="color:rgba(255, 255, 255, 0.7)">Category</div>

              <div class="d-flex flex-wrap gap-2">
                <!-- All -->
                <button type="button" class="badge rounded-pill px-3 py-2 chip border cursor-pointer"
                  [class.active-chip]="selectedTypeId==='all'" (click)="selectType('all')">
                  All
                </button>

                <!-- Dynamic categories -->
                <button *ngFor="let t of CATEGORIES; trackBy: trackByType" type="button"
                  class="badge rounded-pill px-3 py-2 chip border cursor-pointer"
                  [class.active-chip]="(getTypeId(t) === selectedTypeId)" (click)="selectType(getTypeId(t))">
                  {{ getTypeName(t) }}
                </button>
              </div>
            </div>

            <hr class="my-3 border-divider">

            <div class="mb-2 small text-secondary">Steam-like tags</div>
            <div class="form-check mb-2 d-flex align-items-center gap-2 text-white-70 small">
              <input class="form-check-input border-secondary" type="checkbox" id="chkAchievements" checked>
              <label class="form-check-label" for="chkAchievements">Achievements</label>
            </div>
            <div class="form-check d-flex align-items-center gap-2 text-white-70 small">
              <input class="form-check-input border-secondary" type="checkbox" id="chkCloud" checked>
              <label class="form-check-label" for="chkCloud">Cloud Saves</label>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>